<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CinesLlefia</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="assets/iconos/css/all.css">
</head>
<body>
<header>
    <div class="container_fluid">
        <div class="container">
            <div class="fila menu menu-login">
                <ul class="flex">
                    <li>
                        <a><img src="assets/logo.jpg" alt="" class="icon"></a>
                    </li>
                    <li>
                        <a>Iniciar Sesion</a>
                    </li>
                    <li>
                        <a>Crear cuenta</a>
                    </li>
                </ul>
            </div>
            <div class="fila flex menu-header">
                <div class="menu">
                    <a><img src="assets/cinesa-logo.jpg" alt="" class="logo"></a>
                </div>
                <div class="menu menu-header">
                    <ul class="flex">
                        <li><a href="">Cines</a></li>
                        <li><a href="">Películas</a></li>
                        <li><a href="">Eventos</a></li>
                        <li><a href="">Promos</a></li>
                        <li><a href="">Cinesa Luxe</a></li>
                        <li><a href="">Cinesacard</a></li>
                        <li><a href="">Bussines</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</header>
<main >
    <div class="container_fluid fondo">
        <div class="main-margins">
            <div class="container_fluid">
                <div class="container main-content">
                    <div class="menu menu-main-wrapper">
                        <div class="container ">
                            <ul class="flex menu-content">
                                <li><a href="">ESTRENOS</a></li>
                                <li><a href="">CARTELERA</a></li>
                                <li><a href="">PROXIMO</a></li>
                                <li><a href="">IMAX</a></li>
                                <li><a href="">ISENSE</a></li>
                                <li><a href="">DOLBYCINEMA</a></li>
                                <li><a href="">SCREENX</a></li>
                                <li><a href="">WHATSCINE</a></li>
                                <li><a href="">INFANTIL</a></li>
                                <li><a href="">CICLOS</a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="menu menu-end menu-main-wrapper ">
                        <div class="container menu-end">
                            <span>Ordenar por</span>
                            <a href="#" class="button button-blue">TOP PELICULAS</a>
                            <a href="#" class="button button-white">A-Z</a>
                        </div>
                    </div>
                    <div class="col-fichas"></div>
                </div>
            </div>
        </div>
    </div>
</main>
<footer>
    <div class="container_fluid">
        <div class="container icons-rrss">
            <div class="fila menu icons">
                <ul>
                    <li><a href=""><i class="fab fa-facebook"></i></a></li>
                    <li><a href=""><i class="fab fa-twitter"></i></a></li>
                    <li><a href=""><i class="fab fa-instagram-square"></i></a></a></li>
                    <li><a href=""><i class="fab fa-youtube"></i></a></li>
                </ul>
            </div>
        </div>
        <div class="container">
            <div class="fila menu menu-footer">
                <div class="col menu-footer-col">
                    <h3>Titulo test</h3>
                    <ul>
                        <li><a href="">Trabaja con nosotros </a></li>
                        <li><a href="">Cinesa Business</a></li>
                        <li><a href="">Mapa del site</a></li>
                        <li><a href="">Blog Cinesa</a></li>
                        <li><a href="">CINESACHECKonline</a></li>
                    </ul>
                </div>
                <div class="col menu-footer-col">
                    <h3>Titulo test</h3>
                    <ul>
                        <li><a href="">Trabaja con nosotros </a></li>
                        <li><a href="">Cinesa Business</a></li>
                        <li><a href="">Mapa del site</a></li>
                        <li><a href="">Blog Cinesa</a></li>
                        <li><a href="">CINESACHECKonline</a></li>
                    </ul>
                </div>
                <div class="col menu-footer-col">
                    <h3>Titulo test</h3>
                    <ul>
                        <li><a href="">Trabaja con nosotros </a></li>
                        <li><a href="">Cinesa Business</a></li>
                        <li><a href="">Mapa del site</a></li>
                        <li><a href="">Blog Cinesa</a></li>
                        <li><a href="">CINESACHECKonline</a></li>
                    </ul>
                </div>
                <div class="col menu-footer-col">
                    <h3>Titulo test</h3>
                    <ul>
                        <li><a href="">Trabaja con nosotros </a></li>
                        <li><a href="">Cinesa Business</a></li>
                        <li><a href="">Mapa del site</a></li>
                        <li><a href="">Blog Cinesa</a></li>
                        <li><a href="">CINESACHECKonline</a></li>
                        <li><a href="">Mapa del site</a></li>
                        <li><a href="">Blog Cinesa</a></li>
                        <li><a href="">CINESACHECKonline</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</footer>
<script type="module">
    const xmlPath='https://daw2-mtz22.github.io/M4_P1_MartinezAaron/assets/peliculas.xml'
    const createFichaBody = (title, portadaPath, rating, votos) => {
        return `
        <div class="ficha">
            <div class="col-fichas">
                <h3 class="ficha-title">${title}</h3>
                <div class="ficha-img-wrapper">
                    <img src="./assets/${portadaPath}" alt="${title}">
                </div>
                <div class="ficha-rating-wrapper">
                    ${createRatingBody(rating)}
                    <span class="votos">(${votos} votos)</span>
                </div>
            </div>
        </div>
    `;
    }
    const createFilmBody = filmData =>{
        return`<div class="film-content">
            <div class="flex film-menu">
                <div class="film-menu-button">
                    <a>ANTERIOR</a>
                </div>
                <div>
                    <h3>${filmData.title}</h3>
                </div>
                <div class="film-menu-button">
                    <a>SIGUIENTE</a>
                </div>
            </div>
            <div class="flex film-body">
                <div>
                    <div class="flex film-body-images">
                        <img class="imagen-portada" src="./assets/${filmData.imagePortada}" alt="">
                            <img class="imagen-poster" src="./assets/${filmData.imagePoster}" alt="">
                    </div>
                    <div class="flex film-body-rating">
                        <div class="estrellas">
                            <img src="assets/star-solid.svg" alt="star">
                                <img src="assets/star-solid.svg" alt="star">
                                    <img src="assets/star-solid.svg" alt="star">
                                        <img src="assets/star-solid.svg" alt="star">
                                            <img src="assets/star-solid.svg" alt="star">
                        </div>
                        <div><a href="">RRSS</a></div>
                    </div>
                </div>
                <div class="film-description">
                    <p>Duracion: ${filmData.duration}</p>
                    <p>Pais: ${filmData.country}</p>
                    <p>Genero: ${filmData.category}</p>
                    <p>Estreno: ${filmData.premiere}</p>
                </div>
            </div>
            <div class="film-footer">
                <div class="film-footer-text">
                    <p>Sinopsis: ${filmData.sinopsis}</p>
                </div>
            </div>
        </div>`
    }
    const createRatingBody = (rating = 0) => {
        let ratingBody = ''
        for (let i = rating; i >= 1; i--) {
            ratingBody += '<img src="assets/star-solid.svg" alt="star">'
            rating = i
        }
        if (rating % 1 !== 0) {

            ratingBody += '<img src="assets/star-half-solid.svg" alt="star-half">'
        }
        return `<span class="estrellas">${ratingBody}</span>`
    }
    const writeOnHtmlByClass = (divClass, content, addClass) => {
        if (typeof document !== 'undefined') {
            let containerDiv = document.getElementsByClassName(divClass)[0]
            if(addClass){
                containerDiv.classList.add(addClass)
            }
            containerDiv.innerHTML = content
        }
    }
    const addEventFichas = () =>{
        if (typeof document !== 'undefined') {
            let fichas = document.querySelectorAll('.ficha')
            fichas.forEach((ficha, index)=>{
                ficha.addEventListener('click', () =>{
                    filmXmlRequest(index)
                })
            })
        }
    }
    const addEventToFilmButtons = (index, numOfFilms) =>{
        if (typeof document !== 'undefined') {
            let buttons = document.querySelectorAll('.film-menu-button')

            buttons[0].addEventListener('click', () =>{
                index-1 < 0 ? filmXmlRequest(numOfFilms) : filmXmlRequest(index-1)
            })
            buttons[1].addEventListener('click', () =>{
                index+1>numOfFilms ? filmXmlRequest(0) : filmXmlRequest(index+1)
            })
        }
    }
    const filmXmlRequest = (index) =>{
        console.log(index)
        let filmData
        fetch(xmlPath)
            .then(response => response.text())
            .then(data => {
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(data, 'text/xml');
                const filmXml = xmlDoc.getElementsByTagName('pelicula')[index];
                const xmlLength = xmlDoc.getElementsByTagName('pelicula').length
                    filmData = {
                        title: filmXml.getElementsByTagName('titulo')[0].textContent,
                        imagePortada:filmXml.getElementsByTagName('imagenPortada')[0].textContent,
                        imagePoster:filmXml.getElementsByTagName('imagenCentral')[0].textContent,
                        duration:filmXml.getElementsByTagName('duracion')[0].textContent,
                        country:filmXml.getElementsByTagName('pais')[0].textContent,
                        category:filmXml.getElementsByTagName('generos')[0].textContent,
                        premiere:filmXml.getElementsByTagName('estreno')[0].textContent,
                        sinopsis:filmXml.getElementsByTagName('sinopsis')[0].textContent,
                        rating:filmXml.getElementsByTagName('estrellas')[0].textContent,
                        votos: filmXml.getElementsByTagName('votos')[0].textContent
                    }

                const filmHtml = createFilmBody(filmData)
                writeOnHtmlByClass('container main-content', filmHtml,'film-content-wrapper')
                //Añadir los eventos a los botones de atrás
                addEventToFilmButtons(index , xmlLength-1)
            })
            .catch(error => {
                console.error('Error loading the XML file', error);
            });
    }
    const fichasXmlRequest = filePath => {
        let fichasHTML = '';
        fetch(filePath)
            .then(response => response.text())
            .then(data => {
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(data, 'text/xml');
                const elements = xmlDoc.getElementsByTagName('pelicula');
                for (let i = 0; i < elements.length; i++) {
                    const title = elements[i].getElementsByTagName('titulo')[0].textContent;
                    const imagePath = elements[i].getElementsByTagName('imagenPortada')[0].textContent;
                    const rating = elements[i].getElementsByTagName('estrellas')[0].textContent;
                    const votos = elements[i].getElementsByTagName('votos')[0].textContent;
                    fichasHTML += createFichaBody(title, imagePath, rating, votos)
                }
                writeOnHtmlByClass('col-fichas',fichasHTML)
                addEventFichas()
            })
            .catch(error => {
                console.error('Error loading the XML file', error);
            });
    }
    fichasXmlRequest(xmlPath)

</script>
</body>
</html>